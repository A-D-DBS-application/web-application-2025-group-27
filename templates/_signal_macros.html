{% macro signal_card(sig, show_new_badge=False) %}
<div class="bg-slate-50 rounded-lg p-5 border border-slate-200 {% if show_new_badge and sig.is_new %}ring-2 ring-blue-200{% endif %}">
    <div class="flex items-center justify-between mb-2">
        <div class="flex items-center gap-3">
            {% if show_new_badge and sig.is_new %}
            <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-700 border border-blue-200">
                NEW
            </span>
            {% endif %}
            <h3 class="text-lg font-semibold text-slate-900">
                {% if sig.source_url %}
                <a href="{{ sig.source_url }}" target="_blank" rel="noopener noreferrer" class="hover:text-primary-600 hover:underline transition-colors duration-200">
                    {{ sig.message }}
                </a>
                {% elif sig.competitor %}
                <a href="https://www.google.com/search?q={{ (sig.competitor.name + ' ' + sig.message)|urlencode }}" target="_blank" rel="noopener noreferrer" class="hover:text-primary-600 hover:underline transition-colors duration-200">
                    {{ sig.message }}
                </a>
                {% else %}
                {{ sig.message }}
                {% endif %}
            </h3>
        </div>
        <div class="flex items-center gap-2">
            {{ whatsapp_share_button(sig) }}
            {{ severity_badge(sig.severity) }}
        </div>
    </div>
    {% if sig.competitor %}
    <p class="text-xs text-slate-500 mb-2">
        <i data-lucide="building-2" class="w-3 h-3 inline mr-1"></i>
        Rival: <a href="{{ url_for('main.competitor_detail', competitor_id=sig.competitor_id) }}" class="text-blue-600 hover:underline">{{ sig.competitor.name }}</a>
    </p>
    {% endif %}
    {% set details_data = parse_signal_details(sig) %}
    <p class="text-slate-600 text-sm leading-relaxed">
        {{ details_data.text }}
    </p>
    {% if details_data.related_news and details_data.related_news|length > 0 %}
    <div class="mt-3 pt-3 border-t border-slate-200">
        <div class="flex items-center gap-2 mb-2">
            <i data-lucide="newspaper" class="w-4 h-4 text-slate-500"></i>
            <p class="text-xs font-medium text-slate-700">Related News ({{ details_data.related_news|length }})</p>
        </div>
        <div class="space-y-2">
            {% for news in details_data.related_news %}
            <div class="bg-white rounded-lg p-3 border border-slate-200 hover:border-blue-300 transition-colors duration-200">
                {% if news.url %}
                <a href="{{ news.url }}" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-blue-600 hover:text-blue-700 hover:underline flex items-start gap-2">
                    <i data-lucide="external-link" class="w-3 h-3 mt-0.5 flex-shrink-0"></i>
                    <span>{{ news.title or news.url }}</span>
                </a>
                {% else %}
                <p class="text-sm font-medium text-slate-900">{{ news.title or 'News article' }}</p>
                {% endif %}
                {% if news.summary %}
                <p class="text-xs text-slate-600 mt-1.5 ml-5">{{ news.summary }}</p>
                {% endif %}
                {% if news.source_name %}
                <p class="text-xs text-slate-500 mt-1 ml-5">Source: {{ news.source_name }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    {% if sig.created_at %}
    <p class="mt-2 text-xs text-slate-500">
        Detected on {{ sig.created_at.strftime('%Y-%m-%d at %H:%M') }}
    </p>
    {% endif %}
</div>
{% endmacro %}

{% macro whatsapp_share_button(sig) %}
{% set share_text = sig.message %}
{% if sig.competitor %}
    {% set share_text = sig.competitor.name + ': ' + sig.message %}
{% endif %}
{% set details_data = parse_signal_details(sig) %}
{% if details_data.text %}
    {% set share_text = share_text + '\n\n' + details_data.text %}
{% endif %}
{% if sig.created_at %}
    {% set share_text = share_text + '\n\nDetected on ' + sig.created_at.strftime('%Y-%m-%d at %H:%M') %}
{% endif %}
<a href="https://wa.me/?text={{ share_text|urlencode }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-green-700 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors duration-200" title="Share via WhatsApp">
    <i data-lucide="share-2" class="w-3 h-3"></i>
    Share
</a>
{% endmacro %}

{% macro severity_badge(severity) %}
<span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-medium
    {% if severity == 'high' %}
        bg-red-50 text-red-700 border border-red-200
    {% elif severity == 'medium' %}
        bg-amber-50 text-amber-700 border border-amber-200
    {% else %}
        bg-emerald-50 text-emerald-700 border border-emerald-200
    {% endif %}">
    {{ severity|capitalize }}
</span>
{% endmacro %}

{% macro news_item(news, show_competitor_link=False) %}
<div class="bg-slate-50 rounded-lg p-5 border border-slate-200 hover:border-blue-300 transition-colors duration-200">
    <div class="flex items-start justify-between mb-2">
        <div class="flex-1">
            {% if news.url %}
            <a href="{{ news.url }}" target="_blank" rel="noopener noreferrer" class="text-base font-semibold text-blue-600 hover:text-blue-700 hover:underline flex items-start gap-2">
                <i data-lucide="external-link" class="w-4 h-4 mt-0.5 flex-shrink-0"></i>
                <span>{{ news.title or news.url }}</span>
            </a>
            {% else %}
            <p class="text-base font-semibold text-slate-900">{{ news.title or 'News article' }}</p>
            {% endif %}
            {% if news.summary %}
            <p class="text-sm text-slate-600 mt-2 ml-6">{{ news.summary }}</p>
            {% endif %}
        </div>
    </div>
    <div class="mt-3 pt-3 border-t border-slate-200 flex items-center gap-4 text-xs text-slate-500">
        {% if news.competitor %}
        <div class="flex items-center gap-1">
            <i data-lucide="building-2" class="w-3 h-3"></i>
            {% if show_competitor_link %}
            <a href="{{ url_for('main.competitor_detail', competitor_id=news.competitor.id) }}" class="text-blue-600 hover:underline">
                {{ news.competitor.name }}
            </a>
            {% else %}
            <span class="text-blue-600">{{ news.competitor.name }}</span>
            {% endif %}
        </div>
        {% endif %}
        {% if news.source_name %}
        <div class="flex items-center gap-1">
            <i data-lucide="file-text" class="w-3 h-3"></i>
            <span>{{ news.source_name }}</span>
        </div>
        {% endif %}
        {% if news.signal_category %}
        <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium
            {% if news.signal_category == 'hiring' %}
                bg-blue-50 text-blue-700 border border-blue-200
            {% elif news.signal_category == 'product' %}
                bg-purple-50 text-purple-700 border border-purple-200
            {% elif news.signal_category == 'funding' %}
                bg-green-50 text-green-700 border border-green-200
            {% else %}
                bg-slate-100 text-slate-600 border border-slate-200
            {% endif %}">
            {{ news.signal_category|title }}
        </span>
        {% endif %}
        {% if news.created_at %}
        <div class="flex items-center gap-1 ml-auto">
            <i data-lucide="clock" class="w-3 h-3"></i>
            <span>{{ news.created_at.strftime('%Y-%m-%d') }}</span>
        </div>
        {% endif %}
    </div>
    {% if news.signal_message %}
    <div class="mt-2 pt-2 border-t border-slate-100">
        <p class="text-xs text-slate-500">
            <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
            Related to: <span class="font-medium">{{ news.signal_message }}</span>
        </p>
    </div>
    {% endif %}
</div>
{% endmacro %}

