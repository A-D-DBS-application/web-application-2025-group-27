{% macro signal_card(sig, show_new_badge=False) %}
<div class="bg-slate-50 rounded-lg p-5 border border-slate-200 {% if show_new_badge and sig.is_new %}ring-2 ring-blue-200{% endif %}">
    <div class="flex items-center justify-between mb-2">
        <div class="flex items-center gap-3">
            {% if show_new_badge and sig.is_new %}
            <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-700 border border-blue-200">
                NEW
            </span>
            {% endif %}
            <h3 class="text-lg font-semibold text-slate-900">
                {% if sig.source_url %}
                <a href="{{ sig.source_url }}" target="_blank" rel="noopener noreferrer" class="hover:text-primary-600 hover:underline transition-colors duration-200">
                    {{ sig.message }}
                </a>
                {% elif sig.competitor %}
                <a href="https://www.google.com/search?q={{ (sig.competitor.name + ' ' + sig.message)|urlencode }}" target="_blank" rel="noopener noreferrer" class="hover:text-primary-600 hover:underline transition-colors duration-200">
                    {{ sig.message }}
                </a>
                {% else %}
                {{ sig.message }}
                {% endif %}
            </h3>
        </div>
        <div class="flex items-center gap-2">
            {{ whatsapp_share_button(sig) }}
            {{ severity_badge(sig.severity) }}
        </div>
    </div>
    {% if sig.competitor %}
    <p class="text-xs text-slate-500 mb-2">
        <i data-lucide="building-2" class="w-3 h-3 inline mr-1"></i>
        Rival: <a href="{{ url_for('main.competitor_detail', competitor_id=sig.competitor_id) }}" class="text-blue-600 hover:underline">{{ sig.competitor.name }}</a>
    </p>
    {% endif %}
    <p class="text-slate-600 text-sm leading-relaxed">
        {{ sig.details }}
    </p>
    {% if sig.created_at %}
    <p class="mt-2 text-xs text-slate-500">
        Detected on {{ sig.created_at.strftime('%Y-%m-%d at %H:%M') }}
    </p>
    {% endif %}
</div>
{% endmacro %}

{% macro whatsapp_share_button(sig) %}
{% set share_text = sig.message %}
{% if sig.competitor %}
    {% set share_text = sig.competitor.name + ': ' + sig.message %}
{% endif %}
{% if sig.details %}
    {% set share_text = share_text + '\n\n' + sig.details %}
{% endif %}
{% if sig.created_at %}
    {% set share_text = share_text + '\n\nDetected on ' + sig.created_at.strftime('%Y-%m-%d at %H:%M') %}
{% endif %}
<a href="https://wa.me/?text={{ share_text|urlencode }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-green-700 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors duration-200" title="Share via WhatsApp">
    <i data-lucide="share-2" class="w-3 h-3"></i>
    Share
</a>
{% endmacro %}

{% macro severity_badge(severity) %}
<span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-medium
    {% if severity == 'high' %}
        bg-red-50 text-red-700 border border-red-200
    {% elif severity == 'medium' %}
        bg-amber-50 text-amber-700 border border-amber-200
    {% else %}
        bg-emerald-50 text-emerald-700 border border-emerald-200
    {% endif %}">
    {{ severity|capitalize }}
</span>
{% endmacro %}

